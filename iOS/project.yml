name: PadawanWallet
options:
  deploymentTarget:
    iOS: '16.1'

packages:
  BitcoinDevKit:
    url: https://github.com/bitcoindevkit/bdk-swift
    version: 2.0.0
  KeychainAccess:
    url: https://github.com/kishikawakatsumi/KeychainAccess.git
    version: 4.2.2
  CodeScanner:
    url: https://github.com/twostraws/CodeScanner.git
    version: 2.0.0
  BitcoinUI:
    url: https://github.com/reez/BitcoinUI.git
    version: 1.0.8

configs:
  Debug: debug
  Release: release

targets:
  PadawanWallet:
    type: application
    platform: iOS
    sources:
      - PadawanWallet
    configFiles:
      Debug: PadawanWallet/Resources/Config/AppConfig.xcconfig
      Release: PadawanWallet/Resources/Config/AppConfig.xcconfig
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.coyotebitcoin.padawanwallet
      DEVELOPMENT_TEAM: $(DEVELOPMENT_TEAM)
      APP_DISPLAY_NAME: "PadawanWallet"
      MARKETING_VERSION: $(MARKETING_VERSION)
      CURRENT_PROJECT_VERSION: $(CURRENT_PROJECT_VERSION)
      ONLY_ACTIVE_ARCH: YES
    info:
      path: PadawanWallet/Resources/Info.plist
      properties:
        FAUCET_URL: $(FAUCET_URL)
        FAUCET_TOKEN: $(FAUCET_TOKEN)
        NSAppTransportSecurity:
          NSAllowsArbitraryLoads: true
        CFBundleShortVersionString: $(MARKETING_VERSION)
        CFBundleVersion: $(CURRENT_PROJECT_VERSION)
        CFBundleIdentifier: $(PRODUCT_BUNDLE_IDENTIFIER)
        CFBundleDisplayName: $(APP_DISPLAY_NAME)
        ITSAppUsesNonExemptEncryption: NO
        UISupportedInterfaceOrientations: [UIInterfaceOrientationPortrait]
        UISupportedInterfaceOrientations~ipad: [UIInterfaceOrientationPortrait, UIInterfaceOrientationPortraitUpsideDown, UIInterfaceOrientationLandscapeLeft, UIInterfaceOrientationLandscapeRight]
        UILaunchStoryboardName: LaunchScreen
        NSCameraUsageDescription: "To allow users to open camera and scan QR code"
        UIAppFonts:
          - outfit_medium.ttf
          - outfit_regular.ttf
          - outfit_semibold.ttf
          - share_tech_mono.ttf

    dependencies:
      - package: BitcoinDevKit
      - package: KeychainAccess
      - package: CodeScanner
      - package: BitcoinUI
          
    preBuildScripts:
      - script: |
                if [[ "$(uname -m)" == arm64 ]]
                then
                    export PATH="/opt/homebrew/bin:$PATH"
                fi

                if command -v swiftgen >/dev/null 2>&1
                then
                    echo "Running SwiftGen..."
                    swiftgen
                else
                    echo "error: SwiftGen não está instalado. Use 'brew install swiftgen'."
                    exit 1
                fi
        name: SwiftGen

  PadawanWalletTests:
    type: bundle.unit-test
    platform: iOS
    sources:
      - PadawanWalletTests
    dependencies:
      - target: PadawanWallet
    info:
      path: PadawanWalletTests/Info.plist
    settings:
      BUNDLE_LOADER: "$(TEST_HOST)"
      TEST_HOST: "$(BUILT_PRODUCTS_DIR)/PadawanWallet.app/PadawanWallet"

  PadawanWalletUITests:
    type: bundle.ui-testing
    platform: iOS
    sources:
      - PadawanWalletUITests
    dependencies:
      - target: PadawanWallet
    info:
      path: PadawanWalletUITests/Info.plist

schemes:
  PadawanWallet-Tests:
    build:
      targets:
        PadawanWalletTests: all
    test:
      targets:
        - name: PadawanWalletTests